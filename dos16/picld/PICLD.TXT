ＰＩＣｌｄ	v0.80

	PIC -> BMP,TIFF,RGB,Q0,DJP,PMT コンバータ



■　はじめに

　この PICld は、以前配布していた PIC2TIF を改名してもので、PIC 形式
の画像ファイルを無圧縮 BMP、無圧縮TIFF、ベタファイルのRGB,Q0、のいず
れかの形式の画像ファイルに変換するプログラムです。
  ほとんどの PIC には対応したつもりです（PIC_FMT.LZH で説明されてい
るものについては）。
　変換では、減色やアスペクト比による調整とかは基本的にはしません。元
のピクセル・データのまま変換します（ただし12,15,16ﾋﾞｯﾄ色は24ﾋﾞｯﾄ色に
拡張されます）。

スピードははやくないのでそのつもりでね。



■　使いかた

    usage: PICld [.FMT] [-opts] picfile(s)[.pic]
     .FMT       出力フォーマット指定 .tif .bmp .rgb .q0 .djp .pmt(.pmy)
     -o<FILE>   出力ファイルを FILE にする（１ファイルのみ）
     -i         ヘッダ情報のみ表示
     -ipr       RGB,Q0 出力で一緒に生成する情報ﾌｧｲﾙを.FALでなく .IPRにする
     -ti        .TIF 指定時、インテル(II)なTIFFで出力
     -tm        .TIF 指定時、モトローラ(MM)なTIFFで出力
     -a[M:N]    入力したPICのｱｽﾍﾟｸﾄ比を強制的に M:N とする
     -mm        コメントから MM ヘッダを取り除かないようにする
     -m<N>[:M]  ﾃﾞｨｻﾞで減色. -m3:8色(16色)  -m4:16色  -m8:256色
		M:ﾃﾞｨｻﾞ･ﾊﾟﾀｰﾝを別のものに変更(0=8x8 他は4x4)
     -d[-]      入力ファイルの日付も複写. -d- で日付の複写を禁止
     -x[N]      X68Kなｱｽﾍﾟｸﾄ比のとき, 横幅を(N+1)/N 倍する. N:2〜5 (省略 3)
     -98        PC9801 のVRAMに表示(手抜き.ﾃﾞﾊﾞｯｸﾞ用)
     -k         PC9801表示(-98)のとき、表示ごとにキー入力待ち
		ESC:中止 CR:次 SPC,TAB:画面表裏切換 T,t:ﾃｷｽﾄ on/off

  picfile を入力して pic を[.FMT]で指定したフォーマットに変換します。
  ファイル名は複数指定できます(-o無指定時）。
  デフォルトで .q0(q0出力) -d(日付複写) オプションが設定されています。
　オプションも複数指定でき、ファイルの前後に指定されても変換を実行す
ル前に設定します。また、同種のオプションが指定されたばあいは後に設定
されたオプションが有効になります。
　RGB は Q0 と同じ構造の（つまり拡張子が違うだけの）フルカラーのベタ
ファイルのことです。もちPC98系画像での RGBパレットファイルとは別もん
です:-)
　RGB,Q0出力では画像情報ファイルの .fal か .ipr を出力します。



■　ファイル指定

  ファイル指定ではワイルド・カード機能があり、MS-DOSのものより拡張さ
れて、
    *	  0文字以上の任意の文字列に一致
    ?	  任意の一文字に一致
    [..]  [ ] 内の文字列のどれか一文字に一致
    [^..] [^ ] 内の文字列以外の一文字に一致
          括弧内では 0-9 のように'-'による範囲指定も可
          また、括弧内では他のワイルドカード文字は機能しない
があります。
  また、パスの区切りとして \ だけでなく / も使えます。



■　対応している PIC

  対応している PIC は
	TYPE 0(X68K:APIC)   4,8,15,16ﾋﾞｯﾄ色
	TYPE 1(88VA) 	    8,12,16ﾋﾞｯﾄ色
	TYPE 2(TOWNS) 	    15ﾋﾞｯﾄ(3万)色
	TYPE 3(MAC)         15ﾋﾞｯﾄ(3万)色
	TYPE15(拡張ヘッダ)  (4,)8,(12,)15,16,24ﾋﾞｯﾄ色
です。
　TYPE 15 は他に32ビット色も有りになっていますが、現在具体的なフォー
マットは決定していないので対応していません。
　対応しているといっても仕様にしたがっただけで実際には確認していない
部分が多いです(apic,mac-picは全くの未確認)。
　TYPE 15 では 4ビット色、12ビット色の画像を作成するツールは作られる
ことはないと思われるので無視してください。



■　ドットの横縦比（アスペクト比）

　このプログラムでは、タイプ０のPICのアスペクト比は13:9、タイプ2の
アスペクト比は 1:1、タイプ15はヘッダにあるものを使います。また /MM
形式のヘッダで /XSSは1:1, /XSNかつ/XFLなら 32:25にし, /MY があれば
縦比率を倍、にしています。

　出力では、TIFF,BMP では解像度に変換します。RGB,Q0出力ではアスペク
ト比は失われます。

　TIFF の解像度にするのは、アスペクト比 m:n とすると、
	m = n = 1 -> 解像度(横,縦)=(100dpi, 100dpi)
	m,n <= 5  ->       (n*50, m*50)
	m,n <= 10 ->       (n*25, m*25)
	m,n <= 50 ->       (n*10, m*10)
	m,n >  50 ->       (n,  , m   )
のようにしています。TOWNS-TIFFのデフォルトの解像度が 75dpi とのことな
ので、それを目安に大雑把に適当に選びました^^;
ドットの縦横比さえ合えばいいや、で、解像度としては不当な値かも^^;

  BMP のときは、解像度は１インチあたりでなく１メートルあたりなので、
TIFFの各解像度を単純に４０倍しているだけです（ほんとは39.37倍だけど
めんどくさいので40^^;）。これも、解像度としては不当な値か...^^;


  単に解像度を調整するだけで、基本的にはアスペクト比でピクセルデータ
自体を変換するようなことはしませんので、TIF,BMP ローダが解像度よりド
ット比を得るようになっていないと、X68K なPICは縦長に表示されてしまう
こと大有りです^^;



■　/MM 形式のヘッダについて

　ＭＥＲＯＮ氏,結城見氏によるコメント部に拡張情報を持たせる/MM形式
については以下のもののみ対応し、他は無視しています。
	/XY????????, /XSS, /XSN, /XFH, /XFL, /MY
（/MM形式については配布されている仕様書を手にいれてください）

  また、apicg で拡張された /AU作者名にも対応しています。



■　ヘッダ情報について

　このプログラムに限らず、画像コンバートで他のフォーマットに変換す
れば、ヘッダ情報はまず劣化（失われ）します。

  pic->rgb,q0 では、rgb,q0自体にはヘッダがなく、.fal,.ipr を併用す
ることにより画像サイズと始点を移せますが、アスペクト比やコメントは
失われます。また、すべてフルカラー(24ビット)色になってしまい、もと
の色数はせいぜい256(,16)かどうかが判別できるくらいで、他はまずわか
らなくなります。

　pic->tif,bmp,djp では、PICの始点情報、コメントは、失われます。12,
15,16ビット色は、フルカラー(24ビット色)に変換されるので、もとの色数
は判別はまずわからなくなります。



□ PMTフォーマットについて

　PMT フォーマットは、始点情報(やコメント)を変換で失いたくない、と
いう個人的都合により拙者がでっちあげたフォーマットで、PICld, PICsv
以外に拙作 mg(v0.95以降)で対応しています（16,256色 apic を始点付で
他のフォーマット(magやpi)に変換する必要が生じたので^^;）
  拡張子は PMTです。以前の版では24ビット色のとき.PMYにしてましたが
それは無しにしました^^;

  このフォーマットについてはソースをみてください.



■　減色について

　-m オプションにより、8色16色256色にディザで減色して出力できます。
　ただ、いまいち変換後の画像はよくないです^^;
  ピクセル・データを改変する不可逆な変換なので、扱いには注意してく
ださい。
　このプログラムはピクセル・データを改変せずに変換する、というのが
基本なので、まあオマケですから...品質は追及しないで^^;



■　x68k なアスペクト比のときの横幅調整

　-x[N] 指定時、入力し画像が x68k なアスペクト比 (x/y=1.25〜1.50)の
とき、横幅を調整します。調整は、Nドットおきに1ドット挿入します。
N が 3 なら、3ドットごとに1ドット挿入ということで横幅 4/3 =1.33倍
します。N が 4 なら、5/4=1.25倍となります。Nは1〜5まで指定可能で、
デフォルトは 3 です。
  また、アスペクト比 x/y = 2/1 = 2.00前後なら横幅を2倍し、1/2 = 0.50
前後なら縦幅を2倍にします（VA-PIC対策です）

  これもピクセル・データを改変する変換なので、扱いには注意してくだ
さい。

  これはディザつけたついでに追加したもので、多色なX68Kのためにあり
ます。だもんで、ディザを行わない16色とか256色では不幸です。



■　参考等

　PIC は、やさぎさわ師が考案された多色画像用の画像圧縮ファイルのフォ
ーマットです。
　tiff は ALDUS社、BMP はマイクロソフト社(?)の画像フォーマットです。

　PIC フォーマットは、柳沢氏の PIC2.DOC の picの説明部分、タ〜坊氏
のPICLBAS.BAS(mz-2500用)とそれに付属のPICの説明、yav氏のxplのソース,
XXXs氏のpic32qのソース、たけちん氏作のpicwlのdefファイル、NIF:FGALav
の会議室の書込み、MERON氏,結城見氏の/MM形式ﾍｯﾀﾞの説明書、 等を参考に
作成しました。その後、やなぎさわ氏が詳細な PIC の仕様書(バイブル)を
発表されたので、推測部分の確認や修正、ローカルなPIC についても対応で
きました。

　ディザは、piclbas.bas, xpl.c のおかげで実現でしました(*^ ^*)

各氏には感謝感謝です。



■　たわごと

  プログラムを作るのが目的で(^^;、X68K な PIC画を BMP,TIFFにして表
示したいとかを目標にしてるわけでないので、ドットの縦横比でピクセル・
データをいじくって調整するようなことはしません（そういうことは他の
ツールに任せますっと...）
　と、v0.50 では書いたけど、v0.60 で -x と -d がつけてしまた^^;
でも、オマケなので、品質を追及しないでね。

  v0.80 において、名前を pic2tif から PICld に改名してしまいました.
　対となる PICsv(旧名rgb2pic)に結局 TIFF入力を付けそうになく、名前の
バランスが悪いので... PIC2BMP,BMP2PICにする予定でしたが、やはし入出
力が遅すぎてやっぱりデフォルトにするのに躊躇しまった^^;



■　おわりに

  コンパイルは、tc(++v1.01)のコンパクト・モデルで行いました。

　フリーソフトウェア(ＦＳＷ)とします。 パソ通(ｵﾝﾗｲﾝ)での非営利配布な
ら作者に連絡不要でしていただいてかまいません（ただし PICsv,PICldを一
緒に行なうこと。片方のみというのは不可... もち配布内容に変更加えると
いうのもナシね）。そうでないばあいとか気になる点のあるばあいは連絡く
ださい（作者の権利を踏みにじるようなことは論外だけど）。もちろん利用
は利用者の責任で用いてください。作者は何の義務も責任も負いません。
ソースの改造、引用については第三者のプログラミングを妨げるような権利
を主張しないかぎりかまいません。ただ改造物の再配布は原作者と同じ配布
条件にし、少なくとも改造物であることと変更者名くらいは明記してくださ
い。

例によってあまり使ってないので、バグな可能性大有りです^^;）

					NBB00541 てんか☆（北村雅史）
