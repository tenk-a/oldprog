ｎｉｆｄｌｔｔｌ  Ver. 1.06



■  はじめに

    このプログラムは、ニフティのログ・ファイル（ nifp 等でログ分割さ
  れたものなど）から、ＤＬのタイトル一覧があれば、その行の説明を整形
  （半角にできるものは半角に、また、説明がファイル名で始まるものなら
  ファイル名を揃えたり）して出力します。
    また、入力するファイルは１つのＤＬに関するものとして、タイトル一
  覧を大きい番号順にソートし、重複行を削除することもできます。

    たとえば、

   4  AAA00002 92/11/12   24443 1344 B TST4.LZH てすと■てすと■てすと■てすと
   3  AAA00003 92/11/01    3334  232 B TST3   .LZH Ｔｅｓｔ Ｐｒｇ． v3.0
   1  AAA00001 92/05/23  233334  232 B test.lzh テスト・てすと・ｔｅｓｔ
   0  AAA00000 91/02/09     300   23 T ｔｅｓｔ０．ｌｚｈ

  を (オプションを -seu したばあい)

   4  AAA00002 92/11/12   24443 1344 B TST4.LZH  てすと■てすと■てすと■てすと
   3  AAA00003 92/11/01    3334  232 B TST3    .LZH Test Prg. v3.0
   1  AAA00001 92/05/23  233334  232 B TEST    .LZH ﾃｽﾄ･てすと・test
   0  AAA00000 91/02/09     300   23 T TEST0   .LZH

  のように変換できます。



■  つかいかた

	use: nifdlttl [-opts] file...

    ファイルとオプションは複数指定可能です。オプションは-seru のよう
  に一つにまとめることができます。ただし-o直後にはファイル名でないと
  いけないので、別のオプションを続けることはできません。



■  オプション

  -s    ソート＆重複行削除を行ないます。
	-pオプションと同時には指定しないでください。

  -m    '拡張子付MSDOS式ファイル名 +説明'をそろえます。
	ファイル名の拡張子は詰めて、その後ろの説明の位置を揃えます。
	
  -e    -mの動作かつ、拡張子の位置を揃えます。

  -u    -mの動作かつ、ファイル名を大文字化します。

  -r    参照数を０にします。
	（ソート＆重複行機能が無かったころの名残です。他のツールで簡
	  単に重複行削除を行なえるように）

  -p    ＤＬ一覧以外の行もそのまま、出力します。

  -d    カレントディレクトリの'nifdlttl.dat'の日付より新しいファイ
        ルのみ処理します。

  -v    作業中のファイル名の表示します。

  -o    入力を BAKファイルにし、そのファイル名で出力します。

  -oPATH  出力を PATH にします。



■  ＤＬタイトルの判定等

    ＤＬのタイトルかどうかの判定は、行の長さ、特定位置の空白の有無、
  番号・ＩＤ・日付の形式に一致するか、で行なっています。
  （行のながさは 40バイト以上 82 バイト未満のものです）

    ファイル名の判定はＭＳＤＯＳのファイル名として、説明の最初が、
	８バイト以内の半角英数字 + '.' + 3バイト以内の拡張子
  のものですが、'.' の前の空白を許すため判定があまいので、間違うこと
  はしばしばあります。
  （OS9 や UNIX などのことは考慮していません^^;）



■  -d オプションについて

    おもに、 -o オプションで複数ファイルを処理するときのためにありま
  す。
    -d を指定すると、カレントディレクトリから 'nifdlttl.dat'というフ
  ァイルをさがし、見つかればそのファイルの日付時間を得（見つからなか
  ったときは最も古い時間だったとする）、ファイル入力時に入力するファ
  イルの日付と比較して、nifdlttl.datのものより新しい日付のファイルの
  み変換処理を行ないます。そして、すべてのファイルの処理を終えたあと、
  nifdlttl.datの日付を更新（nifdlttl.datがなかったときは作成）します。

    -o で一括して変更するとき、 変更の必要のないファイルの処理を省く
  ために用意しましたが、個別に処理したり、-dを指定したりしなかったり
  すると nifdlttl.dat の日付と処理済みのファイルとの関係があわなくな
  るので、そういうときは、FD 等で nifdlttl.dat の日付を調整するなり、
  削除してすべて処理するなりしてください。



■  整形について

    全角で、半角にできるものはまず、半角に変換します。
    半角に変換される全角は、アルファベット、記号、カタカナです。
  記号は、もちろん対応する半角があるものだけです。
  
    ファイル名がみつかり、オプションの  m|e|u が指定されていれば、そ
  れにしたがって揃えます。ただし、揃えた結果、出力する行が 79 バイト
  +改行(1バイト)よりも長くなるようなら、ファイル名の部分の空白をつめ
  て 79バイト+改行になるようにします。
  （元の行が79バイト(+改行1バイト)までなので、それ以上の長さにまず、
    なることはない）

    ｄｌのタイトル以外に、'-'で始まる行はフォーラム名とlib番号が記さ
  れているものとして一緒に出力します（ログ分割ツールが生成していると
  きのため^^;）。



■  ソートについて

    -sオプションを指定すれば、入力したファイルが一つのＤＬに関するも
  のとして、入力時にソートし、重複行を削除します。
    ソートは単に行を文字列として最初の３０数バイトを比較します。ただ
  し'-'で始まる行は一番大きくなるようにし、'-'で始まる行どうしの比較
  では':'が現れるまでを比較します。

    比較の結果一致したなら、こんどは行の長さをくらべ、長いほうを残し
  ます。長さが一緒ならば、今度は長さ制限なしで文字列比較し、大きいほ
  うを残します。



■  おわりに

    このプログラムはTC(++)でコンパイルされています。
    たまにしか使わないし、改造して間もないので虫はいるでせう。

    ぼくはニフティのログは、やなさん氏作の nifp で分割しているのです
  が、 nifp はＤＬ一覧を切り出してくれるので、折角分割されているのだ
  し、課金払って表示したんだから、むざむざ削除するのももったいない、
  けど、このままじゃ順番に揃ってないし重複も多いくてみずらい、っで、
  以前に作って使っていなかったプログラムにソート＆重複行削除をできる
  ようにしたしろものです。
  
  ”個々の一覧を手間をかけて整理・整形する気はない”
  けど、
  ”折角ダウンしたＤＬ一覧だから、すぐ削除するのはもったいない”
  という、めんどくさがりで、せこい、動機なわけです。
    だから、少々間違った変換しても気にしないことにし、いくつか行がか
  けてもかまわない、ログの分割に失敗しているのにきずかずソートしてし
  まったりすれば復旧作業など行なわず削除すりゃいい、という方針で使う
  ものです^^;


    と、フリーウェアです。非営利の配布ならば、連絡不用で自由に配布し
  ていただいてかまいません（って、NIFTY以外で必要なわけないが。 ま、
  とりあず、ね）。
    また、ソースは自由に引用されてかまいませんし、改造してもかまいま
  せんが、改造物を配布するばあいは、最低限改造物であることを受人に伝
  える必要があり、また配布条件を変更してはいけません…改造した部分の
  権利で原作者や第三者の邪魔をしないでね、と。
    もちろん、作者はなんの義務も責任も負いません。利用は使用者の責任
  で行なってください。

  （あっと、ぼくは通信環境を揃えていません... だもんで、便利なツール
    とか知らんので、それらと相性悪いかも...）

						てんか☆
						ニフティ    NBB00541
